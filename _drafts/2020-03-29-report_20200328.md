---
title: "活動記録 2020/03/28 - 特徴量の追加とクロスバリデーションで最高スコアを更新"
last_modified_at: 2020-03-29T12:00:00+09:00
categories:
  - Blog
tags:
  - Kaggle
---

## Kaggleへの挑戦
実際にプログラムを作成して[
House Prices: Advanced Regression Techniques](https://www.kaggle.com/c/house-prices-advanced-regression-techniques/overview)に予測したデータを提出し、スコアを取得した。  

### 既存の特徴量を組み合わせて新しい特徴量を作成
[前回](https://codeseterpie.github.io/blog/report_20200321/)に引き続き、既存の特徴量同士を組み合わせて新しい特徴量を作成し、データ分析を行った。GBDT(勾配ブースティング木)モデルは特徴量同士の和、差は自動的に反映してくれるとのことだったので、特徴量同士の積、商を求めて新しい特徴量とした。今回追加した組み合わせは下の通り。

予測したデータをKaggleに提出した結果、スコアは 0.13242 で、これまでの最高スコア(0.13250)を少し超えることができた。

|変数名|計算式||変数名|計算式|
|:---|:---|:---:|:---|:---|
|MasVnrType_multi_MasVnrArea|MasVnrType×MasVnrArea||LotShape_multi_YearBuilt|LotShape×YearBuilt|
|MasVnrType_div_MasVnrArea|MasVnrType÷MasVnrArea||LotShape_div_YearBuilt|LotShape÷YearBuilt|
|MasVnrArea_div_MasVnrType|MasVnrArea÷MasVnrType||YearBuilt_div_LotShape|YearBuilt÷LotShape|
|LotShape_multi_LotFrontage|LotShape×LotFrontage||LotArea_multi_YearBuilt|LotArea×YearBuilt|
|LotShape_div_LotFrontage|LotShape÷LotFrontage||LotArea_div_YearBuilt|LotArea÷YearBuilt|
|LotFrontage_div_LotShape|LotFrontage÷LotShape||YearBuilt_div_LotArea|YearBuilt÷LotArea|
|LotShape_multi_LotArea|LotShape×LotArea||LotFrontage_multi_YearBuilt|LotFrontage×YearBuilt|
|LotShape_div_LotArea|LotShape÷LotArea||LotFrontage_div_YearBuilt|LotFrontage÷YearBuilt|
|LotArea_div_LotShape|LotArea÷LotShape||YearBuilt_div_LotFrontage|YearBuilt÷LotFrontage|

### カテゴリ変数の設定項目毎にGroup byし、別の変数を集計して新しい特徴量とした

下の図の通り、これまでの方法では学習データの75%しか学習に使用できていないことがわかったため、100%を学習で使用するよう、クロスバリデーションを実施して各モデルから得られた分析結果の平均値を最終結果とするようにしてみた。

<img src="/assets/images/posts/report_20200321/クロスバリデーション.jpg" witdh="500">

予測したデータをKaggleに提出した結果、スコアは 0.13149 で、これまでの最高スコア(0.13250)を超えることができた。

モデルがどの特徴量を重要視したかを出力した下の図を見ると、GrLivArea_multi_OverallQualや1stFlrSF_multi_OverallQualなどが重要視されていることがわかる。

<img src="/assets/images/posts/report_20200328/feature_importance.png" witdh="500">

### まとめ
今回の成果をまとめると下の通りとなり、新しい特徴量を増やし、かつ、クロスバリデーションを実施するとスコアが上昇した結果となった。また、今回追加した新しい特徴量は2つの特徴量の組み合わせのみであるため、3つ以上の組み合わせを試せばこれ以上のスコアの上昇が見込めるかもしれない。

|方法|スコア|
|:---|---:|
|前回までの最高のスコア|0.13250|
|特徴量を追加|0.13242|
|特徴量を追加 & カテゴリ変数をGroup by|**0.13149**|

* 作成したnotebook  
[/Kaggle/HousePrices/notebook/main/20200328/lgb_addfeatur_groupby.ipynb](https://github.com/CodeSeterpie/CodeSeterpie/blob/develop/Kaggle/HousePrices/notebook/main/20200328/lgb_addfeatur_groupby.ipynb)

* 最終的なスコア  
<img src="/assets/images/posts/report_20200328/score_groupby.jpg" witdh="500">

## 課題
* 【継続】[新しい特徴量を作成して増やす必要がある](https://github.com/CodeSeterpie/CodeSeterpie/issues/39)
